{
  "timestamp": "2025-05-30T03:46:28.449Z",
  "mode": "Service Tests",
  "success": false,
  "duration": 4291,
  "output": "\n RUN  v3.1.4 /Users/benweinfeld/Propagentic LLC\n      Coverage enabled with v8\n\nstdout | tests/analytics/ab-testing.test.js\n✅ Test environment setup complete\n\nstdout | tests/analytics/conversion-tracking.test.js\n✅ Test environment setup complete\n\nstdout | tests/analytics/firebase-analytics.test.js\n✅ Test environment setup complete\n\nstdout | tests/analytics/firebase-analytics.test.js\n✅ Mock setup complete for Firebase and external services\n\nstdout | tests/analytics/ab-testing.test.js\n✅ Mock setup complete for Firebase and external services\n\nstdout | tests/analytics/conversion-tracking.test.js\n✅ Mock setup complete for Firebase and external services\n\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Initialization > should initialize successfully with user consent 3ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Initialization > should fail initialization without user consent 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Initialization > should handle initialization errors gracefully 8ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > User Context Management > should set user context correctly 1ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > User Context Management > should not set user context when service is disabled 1ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Event Tracking > should track events with enhanced parameters 3ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Event Tracking > should track page views correctly 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Event Tracking > should batch track multiple events 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Event Tracking > should not track events when service is disabled 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Service Management > should enable and disable service correctly 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Service Management > should clear user data correctly 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Service Management > should return correct status 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Session Management > should generate unique session IDs 0ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Error Handling > should handle tracking errors gracefully 10ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Error Handling > should handle page view tracking errors gracefully 1ms\n ✓ tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Error Handling > should handle user context errors gracefully 0ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Initialization > should initialize successfully 3ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Initialization > should handle initialization errors gracefully 9ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Step Tracking > should track funnel step successfully 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Step Tracking > should not track when service is not initialized 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Step Tracking > should handle tracking errors gracefully 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Conversion Goal Tracking > should track conversion goal successfully 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Conversion Goal Tracking > should log high-value conversions to audit trail 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Conversion Goal Tracking > should not log low-value conversions to audit trail 3ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Conversion Goal Tracking > should not track when service is not initialized 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Analytics > should get funnel analytics successfully 3ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Analytics > should include cohort analysis when requested 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Analytics > should handle analytics errors gracefully 2ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Helper Methods > should return correct stage values 5ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Helper Methods > should return correct stage positions 0ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Helper Methods > should calculate funnel metrics correctly 14ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Helper Methods > should check conversion goals correctly 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Service Status > should return correct status when uninitialized 4ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Service Status > should return correct status when initialized 0ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Error Handling > should handle Firestore errors gracefully in funnel tracking 1ms\n ✓ tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Error Handling > should handle analytics errors gracefully in conversion tracking 4ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Initialization > should initialize successfully 3ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Initialization > should load active experiments during initialization 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Initialization > should handle initialization errors gracefully 22ms\n × tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Creation > should create experiment successfully 20ms\n   → expected \"spy\" to be called with arguments: [ Anything, ObjectContaining{…} ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[33m@@ -1,10 +1,26 @@\u001b[90m\n\u001b[2m  [\u001b[22m\n\u001b[32m-   Anything,\u001b[90m\n\u001b[32m-   ObjectContaining {\u001b[90m\n\u001b[31m+   undefined,\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"createdAt\": {\u001b[90m\n\u001b[31m+       \"seconds\": 1640995200,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"description\": \"Testing button colors\",\u001b[90m\n\u001b[31m+     \"duration\": 14,\u001b[90m\n\u001b[31m+     \"hypothesis\": \"Red button will increase clicks\",\u001b[90m\n\u001b[31m+     \"metrics\": [\u001b[90m\n\u001b[31m+       \"click_rate\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[2m      \"name\": \"Test Experiment\",\u001b[22m\n\u001b[31m+     \"owner\": \"product_team\",\u001b[90m\n\u001b[2m      \"status\": \"draft\",\u001b[22m\n\u001b[31m+     \"targetAudience\": {\u001b[90m\n\u001b[31m+       \"userTypes\": [\u001b[90m\n\u001b[31m+         \"landlord\",\u001b[90m\n\u001b[31m+       ],\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"trafficAllocation\": 50,\u001b[90m\n\u001b[2m      \"type\": \"ui_component\",\u001b[22m\n\u001b[2m      \"variants\": [\u001b[22m\n\u001b[2m        {\u001b[22m\n\u001b[2m          \"allocation\": 50,\u001b[22m\n\u001b[2m          \"configuration\": {},\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n × tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Creation > should reject invalid experiment config 8ms\n   → expected [Function] to throw error including 'Experiment must have at least 2 varia…' but got 'Missing required experiment configura…'\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Creation > should reject missing required fields 2ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Creation > should reject invalid experiment type 1ms\n × tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Management > should start experiment successfully 6ms\n   → expected \"spy\" to be called with arguments: [ Array(2) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[33m@@ -1,9 +1,9 @@\u001b[90m\n\u001b[2m  [\u001b[22m\n\u001b[32m-   Anything,\u001b[90m\n\u001b[31m+   undefined,\u001b[90m\n\u001b[2m    {\u001b[22m\n\u001b[32m-     \"endDate\": Any<ClockDate>,\u001b[90m\n\u001b[31m+     \"endDate\": 2025-06-13T03:46:27.882Z,\u001b[90m\n\u001b[2m      \"startDate\": {\u001b[22m\n\u001b[2m        \"seconds\": 1640995200,\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[2m      \"status\": \"active\",\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Management > should not start non-existent experiment 12ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Management > should not start experiment not in draft status 2ms\n × tests/analytics/ab-testing.test.js > A/B Testing Service > User Assignment > should assign user to experiment successfully 1ms\n   → expected \"spy\" to be called with arguments: [ Anything, …(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   Anything,\u001b[90m\n\u001b[31m+   undefined,\u001b[90m\n\u001b[2m    {\u001b[22m\n\u001b[2m      \"assignedAt\": {\u001b[22m\n\u001b[2m        \"seconds\": 1640995200,\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[2m      \"experimentId\": \"exp123\",\u001b[22m\n\u001b[2m      \"experimentName\": \"Test Experiment\",\u001b[22m\n\u001b[2m      \"experimentType\": \"ui_component\",\u001b[22m\n\u001b[2m      \"userId\": \"user123\",\u001b[22m\n\u001b[32m-     \"variantId\": StringMatching /^variant_[01]$/,\u001b[90m\n\u001b[32m-     \"variantName\": Any<String>,\u001b[90m\n\u001b[31m+     \"variantId\": \"variant_1\",\u001b[90m\n\u001b[31m+     \"variantName\": \"Variant A\",\u001b[90m\n\u001b[2m    },\u001b[22m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > User Assignment > should return null for inactive experiment 2ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > User Assignment > should return cached assignment for already assigned user 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > User Assignment > should respect traffic allocation 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > User Assignment > should handle assignment errors gracefully 1ms\n × tests/analytics/ab-testing.test.js > A/B Testing Service > Variant Retrieval > should get user variant from cache 1ms\n   → expected \"spy\" to not be called at all, but actually been called 1 times\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m    Array [\n      \"mock-query\",\n    ]\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Variant Retrieval > should get user variant from database when not cached 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Variant Retrieval > should return null when user not assigned 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Variant Retrieval > should handle database errors gracefully 1ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Feature Flags > should check feature flag correctly when enabled 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Feature Flags > should check feature flag correctly when disabled 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Feature Flags > should return false when no feature flag experiment exists 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Helper Methods > should select variant based on user hash 1ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Helper Methods > should hash user IDs consistently 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Helper Methods > should match target audience correctly 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Service Status > should return correct status when uninitialized 1ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Service Status > should return correct status when initialized 0ms\n ✓ tests/analytics/ab-testing.test.js > A/B Testing Service > Error Handling > should handle Firestore errors gracefully in experiment creation 1ms\n × tests/analytics/ab-testing.test.js > A/B Testing Service > Error Handling > should handle analytics errors gracefully in assignment 4ms\n   → expected null to be truthy\n\n Test Files  1 failed | 2 passed (3)\n      Tests  6 failed | 59 passed (65)\n   Start at  23:46:26\n   Duration  1.76s (transform 338ms, setup 768ms, collect 238ms, tests 180ms, environment 1.54s, prepare 467ms)\n\n",
  "error": "Command failed: npx vitest run --config tests/vitest.config.js --reporter=verbose --coverage.enabled=true --coverage.reporter=text --coverage.reporter=json --coverage.reporter=html --coverage.reportsDirectory=/Users/benweinfeld/Propagentic LLC/coverage tests/analytics/{firebase-analytics,conversion-tracking,ab-testing}.test.js\n\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\nstderr | tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Initialization > should handle initialization errors gracefully\nConversion tracking initialization failed: Error: Audit logging failed\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/conversion-tracking.test.js:86:50\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Initialization > should handle initialization errors gracefully\nFirebase Analytics initialization failed: Error: Firebase initialization failed\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:76:15\n    at mockCall \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/spy/dist/index.js:66:15\u001b[90m)\u001b[39m\n    at spy \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4mtinyspy\u001b[24m/dist/index.js:45:80\u001b[90m)\u001b[39m\n    at Object.initialize \u001b[90m(/Users/benweinfeld/Propagentic LLC/\u001b[39msrc/services/analytics/firebaseAnalytics.js:24:24\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:79:38\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Step Tracking > should handle tracking errors gracefully\nFailed to track funnel step: Error: Database error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/conversion-tracking.test.js:142:36\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/ab-testing.test.js > A/B Testing Service > Initialization > should handle initialization errors gracefully\nA/B testing initialization failed: Error: Database error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/ab-testing.test.js:116:37\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Funnel Analytics > should handle analytics errors gracefully\nFailed to get funnel analytics: Error: Database error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/conversion-tracking.test.js:272:37\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Error Handling > should handle tracking errors gracefully\nFailed to track event: Error: Tracking failed\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:251:15\n    at mockCall \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/spy/dist/index.js:66:15\u001b[90m)\u001b[39m\n    at spy \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4mtinyspy\u001b[24m/dist/index.js:45:80\u001b[90m)\u001b[39m\n    at Object.trackEvent \u001b[90m(/Users/benweinfeld/Propagentic LLC/\u001b[39msrc/services/analytics/firebaseAnalytics.js:76:7\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:255:31\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Error Handling > should handle page view tracking errors gracefully\nFailed to track page view: Error: Screen tracking failed\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:262:15\n    at mockCall \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/spy/dist/index.js:66:15\u001b[90m)\u001b[39m\n    at spy \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4mtinyspy\u001b[24m/dist/index.js:45:80\u001b[90m)\u001b[39m\n    at Object.trackPageView \u001b[90m(/Users/benweinfeld/Propagentic LLC/\u001b[39msrc/services/analytics/firebaseAnalytics.js:90:7\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:266:31\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/firebase-analytics.test.js > Firebase Analytics Service > Error Handling > should handle user context errors gracefully\nFailed to set user context: Error: User ID setting failed\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:273:15\n    at mockCall \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/spy/dist/index.js:66:15\u001b[90m)\u001b[39m\n    at spy \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4mtinyspy\u001b[24m/dist/index.js:45:80\u001b[90m)\u001b[39m\n    at Object.setUserContext \u001b[90m(/Users/benweinfeld/Propagentic LLC/\u001b[39msrc/services/analytics/firebaseAnalytics.js:47:7\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/firebase-analytics.test.js:277:31\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Error Handling > should handle Firestore errors gracefully in funnel tracking\nFailed to track funnel step: Error: Firestore error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/conversion-tracking.test.js:366:36\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/conversion-tracking.test.js > Conversion Tracking Service > Error Handling > should handle analytics errors gracefully in conversion tracking\nFailed to track conversion goal: Error: Analytics error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/conversion-tracking.test.js:375:63\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Management > should not start non-existent experiment\nFailed to start experiment: Error: Experiment nonexistent not found\n    at Object.startExperiment \u001b[90m(/Users/benweinfeld/Propagentic LLC/\u001b[39msrc/services/analytics/abTesting.js:134:15\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Management > should not start experiment not in draft status\nFailed to start experiment: Error: Cannot start experiment in active status\n    at Object.startExperiment \u001b[90m(/Users/benweinfeld/Propagentic LLC/\u001b[39msrc/services/analytics/abTesting.js:140:15\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/ab-testing.test.js > A/B Testing Service > User Assignment > should handle assignment errors gracefully\nFailed to assign user to experiment: Error: Database error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/ab-testing.test.js:356:36\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/ab-testing.test.js > A/B Testing Service > Variant Retrieval > should handle database errors gracefully\nFailed to get user variant: Error: Database error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/ab-testing.test.js:407:37\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/ab-testing.test.js > A/B Testing Service > Error Handling > should handle Firestore errors gracefully in experiment creation\nFailed to create experiment: Error: Firestore error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/ab-testing.test.js:549:36\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\nstderr | tests/analytics/ab-testing.test.js > A/B Testing Service > Error Handling > should handle analytics errors gracefully in assignment\nFailed to assign user to experiment: Error: Analytics error\n    at \u001b[90m/Users/benweinfeld/Propagentic LLC/\u001b[39mtests/analytics/ab-testing.test.js:567:58\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:103:11\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:596:26\n    at \u001b[90mfile:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:879:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:852:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1360:12\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/benweinfeld/Propagentic%20LLC/\u001b[39mnode_modules/\u001b[4m@vitest\u001b[24m/runner/dist/index.js:1507:8\u001b[90m)\u001b[39m\n\n\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 6 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Creation > should create experiment successfully\nAssertionError: expected \"spy\" to be called with arguments: [ Anything, ObjectContaining{…} ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[33m@@ -1,10 +1,26 @@\u001b[90m\n\u001b[2m  [\u001b[22m\n\u001b[32m-   Anything,\u001b[90m\n\u001b[32m-   ObjectContaining {\u001b[90m\n\u001b[31m+   undefined,\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"createdAt\": {\u001b[90m\n\u001b[31m+       \"seconds\": 1640995200,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"description\": \"Testing button colors\",\u001b[90m\n\u001b[31m+     \"duration\": 14,\u001b[90m\n\u001b[31m+     \"hypothesis\": \"Red button will increase clicks\",\u001b[90m\n\u001b[31m+     \"metrics\": [\u001b[90m\n\u001b[31m+       \"click_rate\",\u001b[90m\n\u001b[31m+     ],\u001b[90m\n\u001b[2m      \"name\": \"Test Experiment\",\u001b[22m\n\u001b[31m+     \"owner\": \"product_team\",\u001b[90m\n\u001b[2m      \"status\": \"draft\",\u001b[22m\n\u001b[31m+     \"targetAudience\": {\u001b[90m\n\u001b[31m+       \"userTypes\": [\u001b[90m\n\u001b[31m+         \"landlord\",\u001b[90m\n\u001b[31m+       ],\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"trafficAllocation\": 50,\u001b[90m\n\u001b[2m      \"type\": \"ui_component\",\u001b[22m\n\u001b[2m      \"variants\": [\u001b[22m\n\u001b[2m        {\u001b[22m\n\u001b[2m          \"allocation\": 50,\u001b[22m\n\u001b[2m          \"configuration\": {},\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n ❯ tests/analytics/ab-testing.test.js:148:22\n    146|       const experiment = await abTesting.createExperiment(config);\n    147| \n    148|       expect(addDoc).toHaveBeenCalledWith(\n       |                      ^\n    149|         expect.anything(),\n    150|         expect.objectContaining({\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/6]⎯\n\n FAIL  tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Creation > should reject invalid experiment config\nAssertionError: expected [Function] to throw error including 'Experiment must have at least 2 varia…' but got 'Missing required experiment configura…'\n\nExpected: \u001b[32m\"Experiment must have at least 2 variants\"\u001b[39m\nReceived: \u001b[31m\"Missing required experiment configuration\"\u001b[39m\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/6]⎯\n\n FAIL  tests/analytics/ab-testing.test.js > A/B Testing Service > Experiment Management > should start experiment successfully\nAssertionError: expected \"spy\" to be called with arguments: [ Array(2) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[33m@@ -1,9 +1,9 @@\u001b[90m\n\u001b[2m  [\u001b[22m\n\u001b[32m-   Anything,\u001b[90m\n\u001b[31m+   undefined,\u001b[90m\n\u001b[2m    {\u001b[22m\n\u001b[32m-     \"endDate\": Any<ClockDate>,\u001b[90m\n\u001b[31m+     \"endDate\": 2025-06-13T03:46:27.882Z,\u001b[90m\n\u001b[2m      \"startDate\": {\u001b[22m\n\u001b[2m        \"seconds\": 1640995200,\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[2m      \"status\": \"active\",\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n ❯ tests/analytics/ab-testing.test.js:235:25\n    233|       const result = await abTesting.startExperiment('exp123');\n    234| \n    235|       expect(updateDoc).toHaveBeenCalledWith(\n       |                         ^\n    236|         expect.anything(),\n    237|         {\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/6]⎯\n\n FAIL  tests/analytics/ab-testing.test.js > A/B Testing Service > User Assignment > should assign user to experiment successfully\nAssertionError: expected \"spy\" to be called with arguments: [ Anything, …(1) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   Anything,\u001b[90m\n\u001b[31m+   undefined,\u001b[90m\n\u001b[2m    {\u001b[22m\n\u001b[2m      \"assignedAt\": {\u001b[22m\n\u001b[2m        \"seconds\": 1640995200,\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[2m      \"experimentId\": \"exp123\",\u001b[22m\n\u001b[2m      \"experimentName\": \"Test Experiment\",\u001b[22m\n\u001b[2m      \"experimentType\": \"ui_component\",\u001b[22m\n\u001b[2m      \"userId\": \"user123\",\u001b[22m\n\u001b[32m-     \"variantId\": StringMatching /^variant_[01]$/,\u001b[90m\n\u001b[32m-     \"variantName\": Any<String>,\u001b[90m\n\u001b[31m+     \"variantId\": \"variant_1\",\u001b[90m\n\u001b[31m+     \"variantName\": \"Variant A\",\u001b[90m\n\u001b[2m    },\u001b[22m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n ❯ tests/analytics/ab-testing.test.js:303:22\n    301|       const assignment = await abTesting.assignUserToExperiment(userId…\n    302| \n    303|       expect(addDoc).toHaveBeenCalledWith(\n       |                      ^\n    304|         expect.anything(),\n    305|         {\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/6]⎯\n\n FAIL  tests/analytics/ab-testing.test.js > A/B Testing Service > Variant Retrieval > should get user variant from cache\nAssertionError: expected \"spy\" to not be called at all, but actually been called 1 times\u001b[90m\n\nReceived: \n\n\u001b[1m  1st spy call:\n\n\u001b[22m    Array [\n      \"mock-query\",\n    ]\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n ❯ tests/analytics/ab-testing.test.js:377:27\n    375| \n    376|       expect(variant).toBe('variant_1');\n    377|       expect(getDocs).not.toHaveBeenCalled();\n       |                           ^\n    378|     });\n    379| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/6]⎯\n\n FAIL  tests/analytics/ab-testing.test.js > A/B Testing Service > Error Handling > should handle analytics errors gracefully in assignment\nAssertionError: expected null to be truthy\n\n\u001b[32m- Expected:\u001b[39m \ntrue\n\n\u001b[31m+ Received:\u001b[39m \nnull\n\n ❯ tests/analytics/ab-testing.test.js:572:26\n    570|       const assignment = await abTesting.assignUserToExperiment('user1…\n    571| \n    572|       expect(assignment).toBeTruthy();\n       |                          ^\n    573|     });\n    574|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/6]⎯\n\n"
}